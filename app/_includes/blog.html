<script>
	document.querySelector("header").style.display = 'inline-block';
</script>

<div id="site-canvas">
	<div class="header-image header-blog">
		<div class="dark-overlay center-text">
			<h1 class="title feature-header">{{site.data[site.active_lang].blog.title}}</h1>
		</div>
	</div>
	<div class="row">
		<div class="large-12 columns">
			{% comment %}
			Group posts by date to handle multilingual posts.
			For posts with the same date, show only one version with links to other languages.
			{% endcomment %}
			{% assign posts_by_date = site.posts | group_by: 'date' %}
			{% for date_group in posts_by_date %}
				{% assign posts_for_date = date_group.items %}
				{% assign current_lang_post = nil %}
				{% assign english_post = nil %}
				{% assign other_posts = "" | split: "," %}
				
				{% comment %}Find the best post to display for this date{% endcomment %}
				{% for post in posts_for_date %}
					{% if post.lang == site.active_lang %}
						{% assign current_lang_post = post %}
					{% elsif post.lang == 'en' %}
						{% assign english_post = post %}
					{% endif %}
					{% assign other_posts = other_posts | push: post %}
				{% endfor %}
				
				{% comment %}Choose which post to display (prefer current language, fallback to English){% endcomment %}
				{% if current_lang_post %}
					{% assign display_post = current_lang_post %}
				{% elsif english_post %}
					{% assign display_post = english_post %}
				{% else %}
					{% assign display_post = posts_for_date.first %}
				{% endif %}
				
				<article class="blog-card">
					<div class="blog-card__image">
						<a href="{{ display_post.url }}" aria-label="Read {{ display_post.title }}">
							<img src="{{ display_post.banner }}" alt="{{ display_post.title }}" />
						</a>
					</div>
					<div class="blog-card__content">
						<h2 class="blog-card__title">
							<a href="{{ display_post.url }}">{{ display_post.title }}</a>
						</h2>
						<div class="blog-card__meta">
							{% assign month_number = display_post.date | date: "%-m" | plus: 0 %}
							<span class="blog-date">{{ display_post.date | date: "%-d" }} {{ site.data[site.active_lang].months[month_number] }} {{ display_post.date | date: "%Y" }}</span>
							<span class="blog-author">by {{ display_post.author }}</span>
						</div>
						
						{% comment %}Show language links if there are multiple versions{% endcomment %}
						{% if posts_for_date.size > 1 %}
							<div class="blog-card__languages">
								<span class="language-label">{{site.data[site.active_lang].blog.also_available}}: </span>
								{% for post in posts_for_date %}
									{% unless post.url == display_post.url %}
										<a href="{{ post.url }}" class="language-link" title="{{ post.title }}">
											{% if post.lang == 'en' %}English{% endif %}
											{% if post.lang == 'fr' %}Français{% endif %}
											{% if post.lang == 'es' %}Español{% endif %}
											{% if post.lang == 'cs' %}Čeština{% endif %}
										</a>
										{% unless forloop.last %} | {% endunless %}
									{% endunless %}
								{% endfor %}
							</div>
						{% endif %}
						
						<div class="blog-card__excerpt">{{ display_post.excerpt }}</div>
					</div>
				</article>
			{% endfor %}
		</div>
	</div>

</div>
